<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Personalized Movie Picks</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>
<body>
    <!-- Header/Navigation -->
    <header>
        <div class="navbar">
            <div class="logo">
                Personalized <span>Movie Picks</span>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Discover Your Next <span>Favorite Movie</span></h1>
            <p class="hero-subtitle">Personalized recommendations based on your taste</p>
            <form action="/search" method="post" class="search-hero">
                <input 
                    type="search" 
                    name="q" 
                    class="search-input" 
                    placeholder="Search movies, actors, or genres..." 
                    autofocus 
                    autocomplete="off"
                    required>
                <button type="submit" class="search-btn">Search</button>
            </form>
        </div>
    </section>

    <!-- Genre Sections -->
    <main class="container" id="genre-container">
        {% if genre_rows %}
            {% for genre, movies in genre_rows.items() %}
                <section class="genre-section">
                    <h2 class="genre-title">{{ genre }}</h2>
                    <div class="genre-movies">
                        {% for movie in movies.data %}
                            <a href="/movie?movie={{ movie.title }}" class="movie-item" style="text-decoration: none;">
                                <img 
                                    src="{{ movie.poster_url }}" 
                                    alt="{{ movie.title }}"
                                    class="movie-poster"
                                    loading="lazy">
                                <p class="movie-title">{{ movie.title }}</p>
                            </a>
                        {% endfor %}
                    </div>
                </section>
            {% endfor %}
        {% else %}
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading your personalized recommendations...</p>
            </div>
        {% endif %}
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 Personalized Movie Picks. All rights reserved.</p>
    </footer>

    <script>
        // Lazy load remaining genres when user scrolls
        const allGenres = {{ all_genres | tojson }};
        const loadedGenres = Object.keys({{ genre_rows.keys() | list | tojson }});
        let currentIndex = loadedGenres.length;

        function loadMoreGenres() {
            if (currentIndex >= allGenres.length) return;

            const genre = allGenres[currentIndex];
            currentIndex++;

            fetch(`/api/genre/${genre}`)
                .then(r => r.json())
                .then(data => {
                    if (!data.error) {
                        const section = document.createElement('section');
                        section.className = 'genre-section';
                        section.innerHTML = `
                            <h2 class="genre-title">${data.genre}</h2>
                            <div class="genre-movies">
                                ${data.movies.map(m => `
                                    <a href="/movie?movie=${encodeURIComponent(m.title)}" class="movie-item" style="text-decoration: none;">
                                        <img src="${m.poster_url}" alt="${m.title}" class="movie-poster" loading="lazy">
                                        <p class="movie-title">${m.title}</p>
                                    </a>
                                `).join('')}
                            </div>
                        `;
                        document.getElementById('genre-container').appendChild(section);
                    }
                });
        }

        // Load more genres when user scrolls near bottom
        window.addEventListener('scroll', () => {
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 1000) {
                loadMoreGenres();
            }
        });
    </script>
</body>
</html>
